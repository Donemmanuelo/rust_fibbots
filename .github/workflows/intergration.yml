name: Fibonacci Comment on PR

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  fibonacci:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Set up Rust
      - name: Set up Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true

      # Step 3: Build the Rust program
      - name: Build the program
        run: cargo build --release

      # Step 4: Set environment variables
      - name: Set environment variables
        env:
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
          GITHUB_REPOSITORY_NAME: ${{ github.event.repository.name }}
          PR_NUMBER: ${{ github.event.number }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "GITHUB_REPOSITORY_OWNER=$GITHUB_REPOSITORY_OWNER" >> $GITHUB_ENV
          echo "GITHUB_REPOSITORY_NAME=$GITHUB_REPOSITORY_NAME" >> $GITHUB_ENV
          echo "PR_NUMBER=$PR_NUMBER" >> $GITHUB_ENV
          echo "GITHUB_TOKEN=$GITHUB_TOKEN" >> $GITHUB_ENV


      # Build and run the Docker container
      - name: Run Docker Container
        run: |
          docker build -t my-fibbot .
          docker run --rm \
            -e max_threshold=1000 \
            -e enable_fib=true \
            -v $(pwd):/workspace \
            my-fibbot ./target/release/fibbot
